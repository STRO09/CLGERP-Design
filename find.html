<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Find Student/Admin - College ERP</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="bg-light">
    <div class="container mt-5">
      <h2 class="mb-4 text-center">Find Your Details</h2>
      <form id="findForm" class="mx-auto" style="max-width: 400px">
        <label for="role" class="form-label">Role</label>
        <div class="mb-3">
          <div class="form-check form-check-inline">
            <input
              class="form-check-input"
              type="radio"
              name="role"
              value="student"
            />
            <label class="form-check-label" for=""> Student </label>
          </div>
          <div class="form-check form-check-inline">
            <input
              class="form-check-input"
              type="radio"
              name="role"
              value="admin"
            />
            <label class="form-check-label" for=""> Admin </label>
          </div>
        </div>
        <div class="mb-3">
          <label for="name" class="form-label">Name</label>
          <input type="text" class="form-control" id="name" required />
        </div>
        <div class="mb-3">
          <label for="number" class="form-label">Number</label>
          <input
            type="tel"
            class="form-control"
            id="number"
            pattern="\d+"
            required
          />
        </div>
        <div class="mb-3">
          <label for="email" class="form-label">Email</label>
          <input type="email" class="form-control" id="email" required />
        </div>

        <button type="submit" class="btn btn-primary w-100">Search</button>
      </form>
      <div id="result" class="mt-4"></div>
      <div class="text-center mt-3">
        <a href="index.html" class="btn btn-link">Back to Home</a>
      </div>
    </div>
    <script>
      // Simulated DB (for demo)
      const users = [
        {
          role: "student",
          name: "Sagar",
          number: "123456",
          email: "sagar@student.com",
          password: "EApex+()33",
          registered: true,
        },
        {
          role: "student",
          name: "John Doe",
          number: "12345",
          email: "john@student.com",
          password: null,
          registered: false,
        },
        {
          role: "admin",
          name: "Admin User",
          number: "99999",
          email: "admin@college.com",
          password: null,
          registered: false,
        },
      ];

      document.getElementById("findForm").onsubmit = function (e) {
        e.preventDefault();

        const role = document.querySelector(
          'input[name="role"]:checked'
        )?.value;
        const name = document.getElementById("name").value.trim();
        const number = document.getElementById("number").value.trim();
        const email = document.getElementById("email").value.trim();
        const resultDiv = document.getElementById("result");

        // Find user
        const user = users.find(
          (u) =>
            u.role === role &&
            u.name === name &&
            u.number === number &&
            u.email === email
        );

        if (!user) {
          resultDiv.innerHTML = `
        <div class="alert alert-danger">
          ${
            role ? role.charAt(0).toUpperCase() + role.slice(1) : "User"
          } not found in database.
        </div>
      `;
          return;
        }

        const isRegistered = user.registered;

        // Success message with spinner
        resultDiv.innerHTML = `
      <div class="alert alert-success">
        ${
          isRegistered
            ? `${
                role.charAt(0).toUpperCase() + role.slice(1)
              } already registered!<br>Redirecting to login page...`
            : `${
                role.charAt(0).toUpperCase() + role.slice(1)
              } found in database.<br>Redirecting to registration page...`
        }
        <div class="text-center mt-3">
          <div class="spinner-border text-success" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
        </div>
      </div>
    `;

        // Redirect after 1 second
        setTimeout(() => {
          if (isRegistered) {
            window.location.href = `login.html?role=${role}`;
          } else {
            window.location.href = `register.html?role=${role}&name=${encodeURIComponent(
              name
            )}&number=${encodeURIComponent(number)}&email=${encodeURIComponent(
              email
            )}`;
          }
        }, 1000);
      };
    </script>
  </body>
</html>
