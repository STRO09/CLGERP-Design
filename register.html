<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Registration - College ERP</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- <style>
      #confirmPassword::-ms-reveal,
      #confirmPassword::-ms-clear,
      #confirmPassword::-webkit-clear-button,
      #confirmPassword::-webkit-reveal-button,
      #confirmPassword::-webkit-textfield-decoration-container {
        display: none !important;
        -webkit-appearance: none !important;
      }
    </style> -->

    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    <!-- CAPTCHA API -->
  </head>
  <body class="bg-light">
    <div class="container mt-5">
      <h2 class="mb-4 text-center" style="font-weight: bolder;">Registration</h2>
      <form id="registerForm" class="mx-auto" style="max-width: 400px">
        <div class="mb-3">
          <label for="name" class="form-label">Name</label>
          <input type="text" class="form-control" id="name" readonly />
        </div>
        <div class="mb-3">
          <label for="number" class="form-label">Number</label>
          <input type="text" class="form-control" id="number" readonly />
        </div>
        <div class="mb-3">
          <label for="email" class="form-label">Email</label>
          <input type="email" class="form-control" id="email" readonly />
        </div>
        <div class="mb-3">
          <label for="password" class="form-label">Enter Password</label>
          <input
            type="password"
            class="form-control"
            id="password"
            pattern="^\S+$"
            minlength="8"
            required
          />
        </div>
        <div class="mb-3">
          <label for="password" class="form-label">Confirm Password</label>
          <input
            type="password"
            class="form-control"
            id="confirmPassword"
            pattern="^\S+$"
            minlength="8"
            required
          />
        </div>

        <div class="mb-3">
          <!-- Google reCAPTCHA widget -->
          <div
            class="g-recaptcha"
            data-sitekey="6LdA0YwrAAAAAPICECeEgJQLFQq_NsgDXqlKhS_p"
          ></div>
        </div>

        <button type="submit" class="btn btn-success w-100">Register</button>
      </form>
      <div id="result" class="mt-4"></div>
      <div class="text-center mt-3">
        <a href="find.html?role=student" class="btn btn-link">Back to Find</a>
      </div>
    </div>
    <script>
      // Simulated DB (for demo)
      const users = [
        {
          role: "student",
          name: "John Doe",
          number: "12345",
          email: "john@student.com",
          registered: false,
        },
        {
          role: "admin",
          name: "Admin User",
          number: "99999",
          email: "admin@college.com",
          registered: false,
        },
      ];
      // Get params from URL
      const urlParams = new URLSearchParams(window.location.search);
      const role = urlParams.get("role") || "student";
      const name = urlParams.get("name") || "";
      const number = urlParams.get("number") || "";
      const email = urlParams.get("email") || "";

      document.getElementById("name").value = name;
      document.getElementById("number").value = number;
      document.getElementById("email").value = email;

      document
        .getElementById("registerForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const password = document.getElementById("password").value;
          const confirmPassword =
            document.getElementById("confirmPassword").value;
          const captchaResponse = grecaptcha.getResponse();
          const resultDiv = document.getElementById("result");

          // ðŸ”¹ 1. Check password match
          if (password !== confirmPassword) {
            resultDiv.innerHTML = `
        <div class="alert alert-danger">
          Passwords do not match. Please try again.
        </div>`;
            return;
          }

          // ðŸ”¹ 2. Check if CAPTCHA filled
          //   if (!captchaResponse) {
          //     resultDiv.innerHTML = `
          // <div class="alert alert-danger">
          //   Please complete the CAPTCHA before submitting.
          // </div>`;
          //     return;
          //   }

          // ðŸ”¹ 3. Check if user exists
          const user = users.find(
            (u) =>
              u.role === role &&
              u.name === name &&
              u.number === number &&
              u.email === email
          );

          if (user && user.registered) {
            resultDiv.innerHTML = `
        <div class="alert alert-warning">
          ${
            role.charAt(0).toUpperCase() + role.slice(1)
          } already registered.<br>
           Redirecting to Login Page......
        </div>`;
          } else if (user) {
            user.registered = true; // Simulate registration
            resultDiv.innerHTML = `
        <div class="alert alert-success">
          Registration successful!<br>
          Redirecting to Login Page......
        </div>`;
          } else {
            resultDiv.innerHTML = `
        <div class="alert alert-danger">
          User not found.
        </div>`;
          }

          setTimeout(() => {
            if (user.registered) {
              window.location.href = `login.html?role=${role}`;
            } else {
            }
          }, 1000);
        });
    </script>
  </body>
</html>
